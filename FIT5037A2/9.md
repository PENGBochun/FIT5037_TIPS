3. - # Task 9: IDS and Attack Detection (Full Guide with OVS Template Installation)

     ## Step 1: Prepare the IDS Node

     Add a new Ubuntu container in the Caulfield LAN and name it **SNORT-IDS**. Configure it with two interfaces:

     - **eth0 (management):** Static IP `10.202.10.25/24`, gateway `10.202.10.1`, DNS `10.202.10.23 8.8.8.8`.
     - **eth1 (monitoring):** No IP, set to promiscuous mode for traffic monitoring.
   
     Configure `/etc/network/interfaces` on SNORT-IDS:
   
     ```bash
     auto eth0
     iface eth0 inet static
         address 10.202.10.25
         netmask 255.255.255.0
         gateway 10.202.10.1
         dns-nameservers 10.202.10.23 8.8.8.8
     
     auto eth1
     iface eth1 inet manual
         up ifconfig eth1 up
     ```
   
     Restart networking afterwards.
   
     ## Step 2: Download and Import OVS Template into GNS3
   
     1. **Download OVS template:**
   
        - Use this link to download the `openvswitch.gns3a` file:
           [OVS Template Download](https://drive.google.com/file/d/1Nb0yklw2ImdpdxQAAq0T3sDWH9DVJ2zd/view?usp=sharing)
   
     2. **Import into GNS3:**
   
        - In GNS3, go to **File → Import appliance**, select the downloaded file, and follow the wizard to import it.
   
     3. **Load OVS kernel module (on your local PC):**
   
        - Minimize GNS3, open a terminal on your host computer, and run:
   
        ```bash
        sudo modprobe openvswitch
        ```
   
        - Enter your password if prompted. This ensures the OVS kernel driver is loaded correctly.
   
     ## Step 3: Replace Switch with OVS
   
     Delete the default GNS3 switch in the Caulfield LAN and replace it with the **Open vSwitch (OVS)** node you just imported.
   
     Connect:
   
     - Firewall → eth0
     - WEB → eth1
     - SSH → eth2
     - SMTP → eth3
     - DNS → eth4
     - CA server → eth5
     - Caulfield Client → eth6
     - IDS eth0 → eth7 (management)
     - IDS eth1 → eth8 (monitoring)
   
     ## Step 4: Configure OVS and Port Mirroring
   
     On the OVS node:
   
     ```bash
     /usr/share/openvswitch/scripts/ovs-ctl start
     ovs-vsctl add-br br0
     
     ovs-vsctl add-port br0 eth0   # Firewall
     ovs-vsctl add-port br0 eth1   # WEB server
     ovs-vsctl add-port br0 eth2   # SSH server
     ovs-vsctl add-port br0 eth3   # SMTP server
     ovs-vsctl add-port br0 eth4   # DNS server
     ovs-vsctl add-port br0 eth5   # CA server
     ovs-vsctl add-port br0 eth6   # Client
     ovs-vsctl add-port br0 eth7   # IDS management
     ovs-vsctl add-port br0 eth8   # IDS monitoring
     
     ovs-vsctl clear Bridge br0 mirrors
     
     ovs-vsctl set Bridge br0 mirrors=@m \
     -- --id=@p_firewall get Port eth0 \
     -- --id=@p_web get Port eth1 \
     -- --id=@p_ssh get Port eth2 \
     -- --id=@p_smtp get Port eth3 \
     -- --id=@p_dns get Port eth4 \
     -- --id=@p_ids get Port eth8 \
     -- --id=@m create Mirror name=mymirror select-all=true output-port=@p_ids
     ```
   
     Verify mirror configuration:
   
     ```bash
     ovs-vsctl list Mirror
     ```
   
     ## Step 5: Install Snort on IDS
   
     ```bash
     apt update
     apt install -y snort net-tools
     ```
   
     Set home network to:
   
     ```
     10.202.10.0/24
     ```
   
     ## Step 6: Configure Snort for Custom Rules
   
     Disable default rule sets and enable only `local.rules`:
   
     ```bash
     sed 's/include $RULE_PATH/#&/' /etc/snort/snort.conf > /etc/snort/snort_custom.conf
     sed -i 's/#include $RULE_PATH\/local.rules/include $RULE_PATH\/local.rules/' /etc/snort/snort_custom.conf
     ```
   
     ## Step 7: Define Custom IDS Rules
   
     ```bash
     cat > /etc/snort/rules/local.rules <<EOF
     # SSH Port Scan Detection
     alert tcp any any -> 10.202.10.22 22 (msg:"SSH Port Scan Detected"; flags:S; flow:stateless; detection_filter: track by_src, count 5, seconds 60; sid:1000002; rev:1;)
     
     # Web Server SYN Flood Detection
     alert tcp any any -> 10.202.10.20 [80,443] (msg:"WEB Server SYN Flood Detected"; flags:S; flow:stateless; detection_filter: track by_src, count 100, seconds 10; sid:1000003; rev:1;)
     EOF
     ```
   
     ## Step 8: Start Snort
   
     Run Snort in IDS mode on monitoring interface eth1:
   
     ```bash
     snort -i eth1 -c /etc/snort/snort_custom.conf -A console
     ```
   
     ## Step 9: Demonstration of Attacks
   
     ### 1. Port Scan on SSH Server
   
     On the External Attacker:
   
     ```bash
     nmap -sS -Pn 10.202.10.22
     ```
   
     Expected: Multiple alerts "SSH Port Scan Detected".
   
     ### 2. SYN Flood on WEB Server
   
     On the External Attacker:
   
     ```bash
     hping3 -S --flood -p 80 10.202.10.20
     ```
   
     Expected: Rapid stream of alerts "WEB Server SYN Flood Detected".
   